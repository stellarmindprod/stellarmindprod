-- ----------------------------------------------------------------------
-- Student Information Tables (b1, b2, b3, b4)
-- Attributes for b1, b2, b3, b4 are: roll no., name, email, password, parent's email, parent's password
-- Note: 'roll no.' is the primary key in a real-world student table, here we use a separate 'id' for auto-increment.
-- ----------------------------------------------------------------------

CREATE TABLE b1 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    roll_no TEXT UNIQUE NOT NULL, -- Corresponds to 'roll no.' (b1 in diagram)
    student_name TEXT NOT NULL,
    student_email TEXT UNIQUE NOT NULL,
    student_password TEXT NOT NULL,
    parent_email TEXT UNIQUE,
    parent_password TEXT
);

CREATE TABLE b2 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    roll_no TEXT UNIQUE NOT NULL, -- Corresponds to 'roll no.'
    student_name TEXT NOT NULL,
    student_email TEXT UNIQUE NOT NULL,
    student_password TEXT NOT NULL,
    parent_email TEXT UNIQUE,
    parent_password TEXT
);

CREATE TABLE b3 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    roll_no TEXT UNIQUE NOT NULL, -- Corresponds to 'roll no.'
    student_name TEXT NOT NULL,
    student_email TEXT UNIQUE NOT NULL,
    student_password TEXT NOT NULL,
    parent_email TEXT UNIQUE,
    parent_password TEXT
);

CREATE TABLE b4 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    roll_no TEXT UNIQUE NOT NULL, -- Corresponds to 'roll no.'
    student_name TEXT NOT NULL,
    student_email TEXT UNIQUE NOT NULL,
    student_password TEXT NOT NULL,
    parent_email TEXT UNIQUE,
    parent_password TEXT
);

---
-- ----------------------------------------------------------------------
-- Course and Grades Tables
-- ----------------------------------------------------------------------

CREATE TABLE courses (
    course_code TEXT PRIMARY KEY,
    course_name TEXT NOT NULL,
    assisting_teacher TEXT,
    credits INTEGER NOT NULL,
    semester INTEGER NOT NULL
);

CREATE TABLE grades (
    roll_no TEXT PRIMARY KEY, -- Using roll_no as the primary key here, linking to student data
    total_credits_sem1 INTEGER, 
    total_credits_sem2 INTEGER,
    total_credits_sem3 INTEGER,
    total_credits_sem4 INTEGER,
    total_credits_sem5 INTEGER,
    total_credits_sem6 INTEGER,
    total_credits_sem7 INTEGER,
    total_credits_sem8 INTEGER,
    sgpa_sem1 NUMERIC(4, 2),
    sgpa_sem2 NUMERIC(4, 2),
    sgpa_sem3 NUMERIC(4, 2),
    sgpa_sem4 NUMERIC(4, 2),
    sgpa_sem5 NUMERIC(4, 2),
    sgpa_sem6 NUMERIC(4, 2),
    sgpa_sem7 NUMERIC(4, 2),
    sgpa_sem8 NUMERIC(4, 2),
    cgpa NUMERIC(4, 2)
);

CREATE TABLE backlogs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, 
    subject_code TEXT NOT NULL,
    semester INTEGER NOT NULL
);

CREATE TABLE teachers (
    teacher_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    teacher_name TEXT NOT NULL,
    department TEXT,
    teacher_password TEXT NOT NULL,
    teacher_email TEXT UNIQUE NOT NULL
);

---
-- ----------------------------------------------------------------------
-- Marks Tables (marks1, marks2, marks3, marks4)
-- Attributes for Marks1, Marks2, Marks3, Marks4 are: roll no., subject code, credits, mid1, mid2, endsem, grades, internal
-- ----------------------------------------------------------------------

CREATE TABLE marks1 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, -- Corresponds to 'roll no.'
    subject_code TEXT NOT NULL,
    credits INTEGER,
    mid1 INTEGER,
    mid2 INTEGER,
    endsem INTEGER,
    final_grade TEXT,
    internal_marks INTEGER
);

CREATE TABLE marks2 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL,
    subject_code TEXT NOT NULL,
    credits INTEGER,
    mid1 INTEGER,
    mid2 INTEGER,
    endsem INTEGER,
    final_grade TEXT,
    internal_marks INTEGER
);

CREATE TABLE marks3 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL,
    subject_code TEXT NOT NULL,
    credits INTEGER,
    mid1 INTEGER,
    mid2 INTEGER,
    endsem INTEGER,
    final_grade TEXT,
    internal_marks INTEGER
);

CREATE TABLE marks4 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL,
    subject_code TEXT NOT NULL,
    credits INTEGER,
    mid1 INTEGER,
    mid2 INTEGER,
    endsem INTEGER,
    final_grade TEXT,
    internal_marks INTEGER
);





-- SQL for batch-specific attendance tables
-- Run this in your Supabase SQL editor to create the new tables.

CREATE TABLE attendance1 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, -- Should match roll_no in b1
    subject_code TEXT NOT NULL,
    subject_name TEXT,
    date DATE NOT NULL,
    status INTEGER NOT NULL DEFAULT 0,       -- classes attended
    total_classes INTEGER NOT NULL DEFAULT 1,-- total classes held
    created_at TIMESTAMPTZ DEFAULT now(),
    -- Foreign key to b1
    CONSTRAINT fk_student_b1 FOREIGN KEY (roll_no) REFERENCES b1 (roll_no) ON DELETE CASCADE
);
-- Index for faster lookups
CREATE INDEX idx_attendance1_roll_no_date ON attendance1 (roll_no, date);

CREATE TABLE attendance2 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, -- Should match roll_no in b2
    subject_code TEXT NOT NULL,
    subject_name TEXT,
    date DATE NOT NULL,
    status INTEGER NOT NULL DEFAULT 0,
    total_classes INTEGER NOT NULL DEFAULT 1,
    created_at TIMESTAMPTZ DEFAULT now(),
    CONSTRAINT fk_student_b2 FOREIGN KEY (roll_no) REFERENCES b2 (roll_no) ON DELETE CASCADE
);
CREATE INDEX idx_attendance2_roll_no_date ON attendance2 (roll_no, date);

CREATE TABLE attendance3 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, -- Should match roll_no in b3
    subject_code TEXT NOT NULL,
    subject_name TEXT,
    date DATE NOT NULL,
    status INTEGER NOT NULL DEFAULT 0,
    total_classes INTEGER NOT NULL DEFAULT 1,
    created_at TIMESTAMPTZ DEFAULT now(),
    CONSTRAINT fk_student_b3 FOREIGN KEY (roll_no) REFERENCES b3 (roll_no) ON DELETE CASCADE
);
CREATE INDEX idx_attendance3_roll_no_date ON attendance3 (roll_no, date);

CREATE TABLE attendance4 (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    roll_no TEXT NOT NULL, -- Should match roll_no in b4
    subject_code TEXT NOT NULL,
    subject_name TEXT,
    date DATE NOT NULL,
    status INTEGER NOT NULL DEFAULT 0,
    total_classes INTEGER NOT NULL DEFAULT 1,
    created_at TIMESTAMPTZ DEFAULT now(),
    CONSTRAINT fk_student_b4 FOREIGN KEY (roll_no) REFERENCES b4 (roll_no) ON DELETE CASCADE
);
CREATE INDEX idx_attendance4_roll_no_date ON attendance4 (roll_no, date);
